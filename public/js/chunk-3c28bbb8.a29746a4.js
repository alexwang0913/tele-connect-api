(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c28bbb8"],{"293a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("div",{staticClass:"container-fluid"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-xl-12"},[a("div",{staticClass:"chat-window"},[a("div",{staticClass:"chat-cont-left"},[t._m(0),t._m(1),a("div",{staticClass:"chat-users-list"},[a("div",{staticClass:"chat-scroll"},t._l(t.contacts,(function(e,s){return a("a",{key:"contact-"+s,staticClass:"media read-chat",class:{active:e._id==t.friendId},attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.joinRoom(e._id)}}},[a("div",{staticClass:"media-img-wrap"},[a("div",{staticClass:"avatar avatar-online"},[a("img",{staticClass:"avatar-img rounded-circle",attrs:{src:t.getAvatarUrl(e.avatarUrl),alt:"User Image"}})])]),a("div",{staticClass:"media-body"},[a("div",[a("div",{staticClass:"user-name"},[t._v(t._s(e.name))])]),a("div")])])})),0)])]),t.friendId?a("div",{staticClass:"chat-cont-right"},[a("div",{staticClass:"chat-header"},[t._m(2),a("div",{staticClass:"media"},[a("div",{staticClass:"media-img-wrap"},[a("div",{staticClass:"avatar avatar-online"},[a("img",{staticClass:"avatar-img rounded-circle",attrs:{src:t.getAvatarUrl(t.friendInfo.avatarUrl),alt:"User Image"}})])]),a("div",{staticClass:"media-body"},[a("div",{staticClass:"user-name"},[t._v(t._s(t.friendInfo.name))]),a("div",{staticClass:"user-status"},[t._v("online")])])]),a("div",{staticClass:"chat-options"},[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(e){return e.preventDefault(),t.openVoiceCall(e)}}},[a("i",{staticClass:"material-icons"},[t._v("local_phone")])]),t._m(3),t._m(4)])]),a("div",{staticClass:"chat-body"},[a("div",{staticClass:"chat-scroll"},[a("ul",{staticClass:"list-unstyled"},t._l(t.histories,(function(e,s){return a("li",{key:"history-"+s,staticClass:"media",class:[{sent:t.user._id==e.senderId},{received:e.senderId==t.friendId}]},[e.senderId==t.friendId?a("div",{staticClass:"avatar"},[a("img",{staticClass:"avatar-img rounded-circle",attrs:{src:t.getAvatarUrl(t.friendInfo.avatarUrl),alt:"User Image"}})]):t._e(),a("div",{staticClass:"media-body"},[a("div",{staticClass:"msg-box"},[a("div",[a("p",[t._v(t._s(e.content))]),a("ul",{staticClass:"chat-msg-info"},[a("li",[a("div",{staticClass:"chat-time"},[a("span",[t._v(t._s(e.time))])])])])])])])])})),0)])]),a("div",{staticClass:"chat-footer"},[a("div",{staticClass:"input-group"},[t._m(5),a("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"input-msg-send form-control",attrs:{type:"text",placeholder:"Type something"},domProps:{value:t.message},on:{keyup:function(e){return e.type.indexOf("key")||13===e.keyCode?t.sendMessage(e):null},input:function(e){e.target.composing||(t.message=e.target.value)}}}),a("div",{staticClass:"input-group-append"},[a("button",{staticClass:"btn msg-send-btn",attrs:{type:"button"},on:{click:t.sendMessage}},[a("i",{staticClass:"fab fa-telegram-plane"})])])])])]):t._e()])])])])])},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"chat-header"},[a("span",[t._v("Chats")]),a("a",{staticClass:"chat-compose",attrs:{href:"javascript:void(0)"}},[a("i",{staticClass:"material-icons"},[t._v("control_point")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"chat-search"},[a("div",{staticClass:"input-group"},[a("div",{staticClass:"input-group-prepend"},[a("i",{staticClass:"fas fa-search"})]),a("input",{staticClass:"form-control",attrs:{type:"text",placeholder:"Search"}})])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a",{staticClass:"back-user-list",attrs:{id:"back_user_list",href:"javascript:void(0)"}},[a("i",{staticClass:"material-icons"},[t._v("chevron_left")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a",{attrs:{href:"javascript:void(0)","data-toggle":"modal","data-target":"#video_call"}},[a("i",{staticClass:"material-icons"},[t._v("videocam")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a",{attrs:{href:"javascript:void(0)"}},[a("i",{staticClass:"material-icons"},[t._v("more_vert")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("div",{staticClass:"btn-file btn"},[a("i",{staticClass:"fa fa-paperclip"}),a("input",{attrs:{type:"file"}})])])}],r=(a("7db0"),a("b0c0"),a("96cf"),a("1da1")),n=a("1157"),c=a.n(n),o=a("bc3a"),d=a.n(o),l=a("db49"),u=a("2805"),f={data:function(){return{contacts:[],friendId:this.$route.query.friendId,friendInfo:{},message:""}},computed:{user:function(){return this.$store.state.user},histories:function(){return this.$store.state.chatHistories}},mounted:function(){c()("body").addClass("chat-page"),this.loadContacts()},destroyed:function(){c()("body").removeClass("chat-page")},methods:{loadContacts:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$vs.loading(),e.next=3,d.a.post(l["b"]+"users/loadContacts",{userId:t.user._id});case 3:a=e.sent,t.contacts=a.data.contacts,t.$vs.loading.close(),null!=t.friendId&&(t.friendInfo=t.contacts.find((function(e){return e._id==t.friendId})));case 7:case"end":return e.stop()}}),e)})))()},getAvatarUrl:function(t){if(t&&t.length>0)return t;var e=a("ee5f");return e("./default-avatar.jpg")},loadChatHistory:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,d.a.post(l["b"]+"chats/getHistory",{senderId:t.user._id,receiverId:t.friendId});case 2:a=e.sent,t.histories=a.data;case 4:case"end":return e.stop()}}),e)})))()},sendMessage:function(){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function e(){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,u["a"].sendMessageToPeer({text:t.message},t.friendId);case 2:a=e.sent,console.log(a),s=new Date,t.$store.commit("addChatHistory",{senderId:t.user._id,receiverId:t.friendId,content:t.message,time:s.getHours()+":"+s.getMinutes()}),t.message="";case 7:case"end":return e.stop()}}),e)})))()},joinRoom:function(t){var e=this;this.friendId=t,this.friendInfo=this.contacts.find((function(t){return t._id==e.friendId}))},openVoiceCall:function(){var t=new Date,e="channel-".concat(t.getTime());this.friendInfo["channel"]=e,this.$store.commit("setCallUser",this.friendInfo),this.$store.commit("updateCallDialogVisibility",!0),this.$socket.emit("REQEST_VOICE_CALL",{receiverId:this.friendId,senderId:this.user._id,senderName:this.user.name,avatarUrl:this.user.avatarUrl,channel:e})}}},v=f,m=a("2877"),h=Object(m["a"])(v,s,i,!1,null,"33388112",null);e["default"]=h.exports},"65f0":function(t,e,a){var s=a("861d"),i=a("e8b5"),r=a("b622"),n=r("species");t.exports=function(t,e){var a;return i(t)&&(a=t.constructor,"function"!=typeof a||a!==Array&&!i(a.prototype)?s(a)&&(a=a[n],null===a&&(a=void 0)):a=void 0),new(void 0===a?Array:a)(0===e?0:e)}},"7db0":function(t,e,a){"use strict";var s=a("23e7"),i=a("b727").find,r=a("44d2"),n=a("ae40"),c="find",o=!0,d=n(c);c in[]&&Array(1)[c]((function(){o=!1})),s({target:"Array",proto:!0,forced:o||!d},{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(c)},ae40:function(t,e,a){var s=a("83ab"),i=a("d039"),r=a("5135"),n=Object.defineProperty,c={},o=function(t){throw t};t.exports=function(t,e){if(r(c,t))return c[t];e||(e={});var a=[][t],d=!!r(e,"ACCESSORS")&&e.ACCESSORS,l=r(e,0)?e[0]:o,u=r(e,1)?e[1]:void 0;return c[t]=!!a&&!i((function(){if(d&&!s)return!0;var t={length:-1};d?n(t,1,{enumerable:!0,get:o}):t[1]=1,a.call(t,l,u)}))}},b0c0:function(t,e,a){var s=a("83ab"),i=a("9bf2").f,r=Function.prototype,n=r.toString,c=/^\s*function ([^ (]*)/,o="name";s&&!(o in r)&&i(r,o,{configurable:!0,get:function(){try{return n.call(this).match(c)[1]}catch(t){return""}}})},b727:function(t,e,a){var s=a("0366"),i=a("44ad"),r=a("7b0b"),n=a("50c4"),c=a("65f0"),o=[].push,d=function(t){var e=1==t,a=2==t,d=3==t,l=4==t,u=6==t,f=5==t||u;return function(v,m,h,p){for(var C,g,_=r(v),b=i(_),y=s(m,h,3),I=n(b.length),w=0,x=p||c,k=e?x(v,I):a?x(v,0):void 0;I>w;w++)if((f||w in b)&&(C=b[w],g=y(C,w,_),t))if(e)k[w]=g;else if(g)switch(t){case 3:return!0;case 5:return C;case 6:return w;case 2:o.call(k,C)}else if(l)return!1;return u?-1:d||l?l:k}};t.exports={forEach:d(0),map:d(1),filter:d(2),some:d(3),every:d(4),find:d(5),findIndex:d(6)}},e8b5:function(t,e,a){var s=a("c6b6");t.exports=Array.isArray||function(t){return"Array"==s(t)}}}]);
//# sourceMappingURL=chunk-3c28bbb8.a29746a4.js.map